## 修改计划

### 1. 分析当前实现
- 当前 `aiService.ts` 只支持 OpenAI API
- 使用固定的请求格式和响应解析逻辑
- API Key 存储和管理逻辑可以保留

### 2. 设计通用 AI 服务架构
- 支持多种模型提供商（OpenAI、阿里云等）
- 抽象 API 调用逻辑，便于扩展
- 保持原有接口不变，确保向后兼容

### 3. 具体修改内容

#### 3.1 修改 aiService.ts
- 增加模型提供商配置选项
- 修改 `processText` 方法，根据不同提供商生成不同的请求
- 调整响应解析逻辑，支持不同格式的流式响应

#### 3.2 阿里云模型 API 适配
- 使用阿里云通义千问 API 作为示例
- 调整请求头：使用 `Authorization: Bearer <api-key>` 或阿里云特有的认证方式
- 调整请求体：符合阿里云 API 的格式要求
- 调整响应解析：处理阿里云的流式响应格式

#### 3.3 保留 OpenAI 支持
- 保持对 OpenAI API 的兼容
- 允许用户在设置中选择模型提供商

### 4. 修改 API Key 设置界面
- 增加模型提供商选择选项
- 根据选择的提供商显示相应的 API Key 输入提示

### 5. 测试和验证
- 确保修改后的代码能正常工作
- 测试两种模型提供商的功能
- 验证流式响应和结果替换功能

### 6. 代码优化
- 提高代码的可维护性和可扩展性
- 增加适当的注释和文档
- 确保错误处理机制完善

## 预期效果
- 支持阿里云模型 API 和 OpenAI API
- 用户可以在设置中选择模型提供商
- 保持原有功能不变
- 流式响应正常工作
- API Key 安全管理

## 技术要点
- 使用策略模式或工厂模式实现多提供商支持
- 抽象 API 调用和响应处理逻辑
- 保持接口的一致性
- 支持动态配置