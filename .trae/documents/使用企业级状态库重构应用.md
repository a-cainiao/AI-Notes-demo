# 使用企业级状态库重构应用计划

## 1. 项目分析

当前项目是一个 AI 笔记应用，使用 React + TypeScript 开发前端，Node.js + TypeScript 开发后端。当前的状态管理使用 React Context API，只有 AuthContext 用于管理用户认证状态，笔记相关的状态管理分散在各个组件中。

## 2. 技术选型

选择 **Redux Toolkit** 作为企业级状态库，原因如下：
- 集中式状态管理，适合大型应用
- 不可变状态更新，保证状态一致性
- 中间件支持，可扩展功能
- 开发工具支持，便于调试
- 持久化支持，可保存状态到本地
- 良好的 TypeScript 支持
- 社区活跃，文档丰富

## 3. 重构计划

### 3.1 前端重构

#### 3.1.1 安装依赖
- 安装 Redux Toolkit 和 React Redux
- 安装 Redux Persist（可选，用于状态持久化）

#### 3.1.2 创建 Redux Store
- 配置 Redux Store
- 添加中间件
- 配置 Redux DevTools

#### 3.1.3 定义切片（Slices）

1. **authSlice**：管理用户认证状态（替代当前的 AuthContext）
   - 状态：user, isLoading, isAuthenticated
   - 操作：login, register, logout, refreshUser

2. **notesSlice**：管理笔记状态
   - 状态：notes, selectedNote, isLoading
   - 操作：fetchNotes, addNote, updateNote, deleteNote, selectNote

3. **categoriesSlice**：管理分类状态
   - 状态：categories, selectedCategory, isLoading
   - 操作：fetchCategories, addCategory, updateCategory, deleteCategory, selectCategory

4. **tagsSlice**：管理标签状态
   - 状态：tags, selectedTags, isLoading
   - 操作：fetchTags, addTag, updateTag, deleteTag, toggleTag

#### 3.1.4 重构组件
- 更新 App.tsx，添加 Redux Provider
- 重构 AuthContext 相关组件，使用 Redux 状态
- 重构笔记组件，使用 Redux 状态
- 添加分类和标签相关组件

### 3.2 后端重构

#### 3.2.1 更新数据模型
- 添加 categories 表
- 添加 tags 表
- 添加 note_tags 关联表
- 更新 notes 表，添加 category_id 字段

#### 3.2.2 更新 API 路由
- 添加分类相关路由
- 添加标签相关路由
- 更新笔记相关路由，支持分类和标签

#### 3.2.3 更新控制器和服务
- 添加分类控制器和服务
- 添加标签控制器和服务
- 更新笔记控制器和服务，支持分类和标签

## 4. 实现步骤

1. 安装 Redux Toolkit 依赖
2. 创建 Redux Store 和切片
3. 重构 AuthContext 为 authSlice
4. 创建 notesSlice，管理笔记状态
5. 创建 categoriesSlice 和 tagsSlice，支持分类和标签功能
6. 重构前端组件，使用 Redux 状态
7. 更新后端数据模型，添加分类和标签表
8. 更新后端 API，支持分类和标签功能
9. 测试重构后的应用

## 5. 预期效果

- 集中式状态管理，便于维护和扩展
- 支持分类功能，用户可以创建、编辑、删除分类，并为笔记分配分类
- 支持标签功能，用户可以创建、编辑、删除标签，并为笔记添加多个标签
- 提高应用性能，减少不必要的 API 调用
- 便于调试和开发，使用 Redux DevTools

## 6. 风险评估

- 重构过程中可能会引入新的 bug
- 需要测试所有功能，确保重构后应用正常运行
- 可能需要调整组件结构，影响开发进度

## 7. 解决方案

- 分阶段重构，先重构认证状态，再重构笔记状态，最后添加分类和标签功能
- 编写测试用例，确保重构后功能正常
- 使用 Redux DevTools 进行调试，便于定位问题
- 保持代码的可维护性和可读性，遵循最佳实践